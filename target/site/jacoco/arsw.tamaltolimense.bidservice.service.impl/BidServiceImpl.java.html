<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="es"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>BidServiceImpl.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">bidService</a> &gt; <a href="index.source.html" class="el_package">arsw.tamaltolimense.bidservice.service.impl</a> &gt; <span class="el_source">BidServiceImpl.java</span></div><h1>BidServiceImpl.java</h1><pre class="source lang-java linenums">package arsw.tamaltolimense.bidservice.service.impl;

import arsw.tamaltolimense.bidservice.classes.Bid;
import arsw.tamaltolimense.bidservice.exception.BidException;
import arsw.tamaltolimense.bidservice.service.BidService;
import org.springframework.stereotype.Service;

import java.util.Map;
import java.util.concurrent.ConcurrentHashMap;

@Service
<span class="fc" id="L12">public class BidServiceImpl implements BidService {</span>

    // In-memory storage for active bids
<span class="fc" id="L15">    private final Map&lt;String, Bid&gt; activeBids = new ConcurrentHashMap&lt;&gt;();</span>

    /**
     * Start a new bid for a container
     * @param containerId the container ID
     * @param initialValue initial bid value
     * @param realValue real value of the container
     * @return the created Bid
     * @throws BidException if a bid already exists for this container
     */
    @Override
    public Bid startBet(String containerId, int initialValue, int realValue) throws BidException {
<span class="fc bfc" id="L27" title="All 4 branches covered.">        if(containerId == null || containerId.trim().isEmpty()) throw new BidException(BidException.NULL_VALUE);</span>
<span class="fc bfc" id="L28" title="All 4 branches covered.">        if(initialValue &lt; 0 || realValue &lt; 0) throw new BidException(BidException.NEGATIVE_VALUE);</span>
<span class="fc bfc" id="L29" title="All 2 branches covered.">        if(realValue &lt; initialValue) throw new BidException(BidException.GREATER_VALUE);</span>
<span class="fc bfc" id="L30" title="All 2 branches covered.">        if (activeBids.containsKey(containerId)) throw new BidException(BidException.BID_EXISTS + containerId);</span>

<span class="fc" id="L32">        Bid newBid = new Bid(containerId, initialValue, realValue);</span>
<span class="fc" id="L33">        activeBids.put(containerId, newBid);</span>
<span class="fc" id="L34">        return newBid;</span>
    }

    /**
     * Place a bid on a container
     * @param containerId the container ID
     * @param owner1 the primary owner
     * @param owner2 the secondary owner (can be null)
     * @param amount the bid amount
     * @return the updated Bid
     * @throws BidException if the bid is invalid or container not found
     */
    @Override
    public Bid placeBid(String containerId, String owner1, String owner2, int amount) throws BidException {
<span class="fc" id="L48">        Bid bid = activeBids.get(containerId);</span>
<span class="pc bpc" id="L49" title="1 of 2 branches missed.">        if (bid == null) throw new BidException(BidException.BID_NOT_EXISTS + containerId);</span>


<span class="pc bpc" id="L52" title="1 of 2 branches missed.">        if (!bid.isOpen()) throw new BidException(BidException.CLOSE);</span>

<span class="fc bfc" id="L54" title="All 4 branches covered.">        if(owner1 == null || owner1.trim().isEmpty()) {</span>
<span class="fc" id="L55">            throw new BidException(BidException.NULL_OWNER);</span>
        }

<span class="pc bpc" id="L58" title="1 of 4 branches missed.">        if (owner2 != null &amp;&amp; !owner2.isEmpty()) {</span>

<span class="fc" id="L60">            bid.placeBid(owner1, owner2, amount);</span>
        } else {
<span class="fc" id="L62">            bid.placeBid(owner1, amount);</span>
        }

<span class="fc" id="L65">        return bid;</span>
    }

    /**
     * Get a bid by container ID
     * @param containerId the container ID
     * @return the Bid or null if not found
     */
    @Override
    public Bid getBidByContainer(String containerId) {
<span class="fc" id="L75">        return activeBids.get(containerId);</span>
    }

    /**
     * Calculate the profit/loss for a bid
     * @param bid the Bid to calculate
     * @return the calculation result (profit/loss)
     */
    @Override
    public int calculate(Bid bid) {
<span class="nc" id="L85">        return bid.calculate();</span>
    }

    /**
     * Close a bid for a container
     * @param containerId the container ID
     * @return the closed Bid
     * @throws BidException if the container is not found
     */
    @Override
    public Bid closeBid(String containerId) throws BidException {
<span class="fc" id="L96">        Bid bid = activeBids.get(containerId);</span>
<span class="fc bfc" id="L97" title="All 2 branches covered.">        if (bid == null) {</span>
<span class="fc" id="L98">            throw new BidException(&quot;No active bid found for container: &quot; + containerId);</span>
        }

<span class="fc" id="L101">        bid.close();</span>
<span class="fc" id="L102">        return bid;</span>
    }

    /**
     * Get all active bids
     * @return map of all active bids
     */
    @Override
    public Map&lt;String, Bid&gt; getAllActiveBids() {
<span class="fc" id="L111">        return activeBids;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.10.202304240956</span></div></body></html>